<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login Page</title>
    <!-- Add your CSS and fontawesome links here -->
</head>
<body>
  <div class="container">
    <div class="forms-container">
      <div class="signin-signup">
        <form action="/login" method="post" class="sign-in-form">
          <div id="message" class="success-message" style="color: red;"> {% if message %} <p>{{ message }}</p> {% endif %}</div>
          <h1>SCMXPertLite</h1>
          <h2 class="title">Sign in</h2>
          <div class="input-field">
            <i class="fas fa-user"></i>
            <input type="text" name="email" placeholder="Username" required/>
          </div>
          <div class="input-field">
            <i class="fas fa-lock"></i>
            <input type="password" name="password" placeholder="Password" required/>
            <i class="toggle-password fas fa-eye" onclick="togglePassword('password')"></i>
          </div>
          <input type="submit" value="Login" class="btn solid" />
        </form>
      </div>
    </div>
  </div>

  <!-- Add a section to display the access token -->
  <div id="token-display" style="margin-top: 20px;"></div>

  <script>
    // Function to store access token in local storage
    function storeAccessToken(token) {
        localStorage.setItem("access_token", token);
    }

    // Function to display the access token
    function displayAccessToken(token) {
        const tokenDisplay = document.getElementById("token-display");
        tokenDisplay.innerHTML = "<h3>Access Token:</h3><pre>" + token + "</pre>";
    }

    // Function to handle login form submission
    async function handleLogin(event) {
        event.preventDefault();

        const email = document.querySelector(".sign-in-form input[name='email']").value;
        const password = document.querySelector(".sign-in-form input[name='password']").value;

        const response = await fetch("/sign", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: new URLSearchParams({
                email: email,
                password: password
            })
        });

        const data = await response.json();
        if (response.ok) {
            // Store access token in local storage
            storeAccessToken(data.access_token);

            // Display the access token
            displayAccessToken(data.access_token);

            // Redirect to the dashboard
            window.location.href = data.redirect_url;
        } else {
            // Handle invalid login
            alert("Invalid email or password!");
        }
    }

    // Attach event listener to the login form
    document.querySelector(".sign-in-form").addEventListener("submit", handleLogin);
  </script>
</body>
</html>
